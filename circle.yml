machine:
  ROOTPATH: /home/ubuntu/go/src/github.com/aarondl/kctl

dependencies:
  pre: 
    - go get github.com/kardianos/govendor
  override:
    - cd $ROOTPATH && govendor sync

deployment:
  release:
    tag: /v[0-9]+(\.[0-9]+){2}/
    owner: aarondl
    commands:
      - go get github.com/tcnksm/ghr
      - mkdir out
      - env GOOS=linux GOARCH=amd64 go build -o dist/kctl-linux-amd64
      - env GOOS=darwin GOARCH=amd64 go build -o dist/kctl-darwin-amd64
      - ghr -t $GITHUB_TOKEN -u $CIRCLE_PROJECT_USERNAME -r $CIRCLE_PROJECT_REPONAME -replace $(cat VERSION) dist/
